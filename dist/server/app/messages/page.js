(()=>{var e={};e.id=750,e.ids=[750],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},8893:e=>{"use strict";e.exports=require("buffer")},4770:e=>{"use strict";e.exports=require("crypto")},7702:e=>{"use strict";e.exports=require("events")},2615:e=>{"use strict";e.exports=require("http")},8791:e=>{"use strict";e.exports=require("https")},8216:e=>{"use strict";e.exports=require("net")},8621:e=>{"use strict";e.exports=require("punycode")},6162:e=>{"use strict";e.exports=require("stream")},2452:e=>{"use strict";e.exports=require("tls")},7360:e=>{"use strict";e.exports=require("url")},1568:e=>{"use strict";e.exports=require("zlib")},5074:(e,s,r)=>{"use strict";r.r(s),r.d(s,{GlobalError:()=>n.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>o,routeModule:()=>x,tree:()=>c}),r(8244),r(7781),r(5866);var t=r(3191),a=r(8716),i=r(7922),n=r.n(i),d=r(5231),l={};for(let e in d)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>d[e]);r.d(s,l);let c=["",{children:["messages",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,8244)),"/Users/sharathchandra/Documents/Make it_2025/sample/UniNest/UniNest/app/messages/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,7781)),"/Users/sharathchandra/Documents/Make it_2025/sample/UniNest/UniNest/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,5866,23)),"next/dist/client/components/not-found-error"]}],o=["/Users/sharathchandra/Documents/Make it_2025/sample/UniNest/UniNest/app/messages/page.tsx"],u="/messages/page",m={require:r,loadChunk:()=>Promise.resolve()},x=new t.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/messages/page",pathname:"/messages",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},7762:(e,s,r)=>{Promise.resolve().then(r.bind(r,1738))},1738:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>_});var t=r(326),a=r(7577),i=r(5047),n=r(1817),d=r(3071),l=r(8758),c=r(567),o=r(9730),u=r(8421);function m({threads:e,loading:s,selectedThread:r,onSelectThread:a}){return s?(0,t.jsxs)(d.Zb,{className:"h-full",children:[t.jsx(d.Ol,{children:(0,t.jsxs)(d.ll,{className:"flex items-center gap-2",children:[t.jsx(o.Z,{className:"h-5 w-5"}),"Messages"]})}),t.jsx(d.aY,{className:"space-y-4",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,t.jsxs)("div",{className:"flex items-center gap-3 animate-pulse",children:[t.jsx("div",{className:"w-10 h-10 bg-muted rounded-full"}),(0,t.jsxs)("div",{className:"flex-1 space-y-2",children:[t.jsx("div",{className:"h-4 bg-muted rounded w-3/4"}),t.jsx("div",{className:"h-3 bg-muted rounded w-1/2"})]})]},s))})]}):(0,t.jsxs)(d.Zb,{className:"h-full",children:[t.jsx(d.Ol,{children:(0,t.jsxs)(d.ll,{className:"flex items-center gap-2",children:[t.jsx(o.Z,{className:"h-5 w-5"}),"Messages"]})}),t.jsx(d.aY,{className:"p-0",children:0===e.length?(0,t.jsxs)("div",{className:"p-6 text-center",children:[t.jsx(o.Z,{className:"h-8 w-8 text-muted-foreground mx-auto mb-2"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"No conversations yet"})]}):t.jsx("div",{className:"space-y-1",children:e.map(e=>t.jsx("div",{className:`p-4 cursor-pointer hover:bg-muted/50 transition-colors border-l-4 ${r?.listingId===e.listing_id&&r?.otherUserId===e.other_user.id?"border-primary bg-muted/50":"border-transparent"}`,onClick:()=>a({listingId:e.listing_id,otherUserId:e.other_user.id,otherUserName:e.other_user.name}),children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsxs)(l.Avatar,{className:"h-10 w-10",children:[t.jsx(l.AvatarImage,{src:e.other_user.photo_url||""}),t.jsx(l.AvatarFallback,{children:e.other_user.name.charAt(0).toUpperCase()})]}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[t.jsx("h4",{className:"font-medium truncate",children:e.other_user.name}),e.unread_count>0&&t.jsx(c.C,{variant:"destructive",className:"text-xs",children:e.unread_count})]}),t.jsx("p",{className:"text-sm text-muted-foreground truncate",children:e.last_message.content}),t.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:(0,u.Q)(new Date(e.last_message.created_at),{addSuffix:!0})})]})]})},`${e.listing_id}-${e.other_user.id}`))})})]})}var x=r(772),h=r(7673),p=r(9436),g=r(8386),f=r(9932);function j({listingId:e,otherUserId:s,otherUserName:r}){let{user:i}=(0,f.a)(),{messages:n,loading:c,sendMessage:o,markAsRead:m}=(0,g.R)(e),[j,v]=(0,a.useState)(""),[_,N]=(0,a.useState)(!1),b=(0,a.useRef)(null),y=async()=>{if(!j.trim()||_)return;N(!0);let r=j.trim();v("");try{await o(e,s,r)}catch(e){console.error("Error sending message:",e),v(r)}finally{N(!1)}};return c?(0,t.jsxs)(d.Zb,{className:"h-full",children:[t.jsx(d.Ol,{children:t.jsx(d.ll,{children:"Loading..."})}),t.jsx(d.aY,{className:"flex-1 flex items-center justify-center",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})]}):(0,t.jsxs)(d.Zb,{className:"h-full flex flex-col",children:[t.jsx(d.Ol,{className:"border-b",children:(0,t.jsxs)(d.ll,{className:"flex items-center gap-3",children:[t.jsx(l.Avatar,{className:"h-8 w-8",children:t.jsx(l.AvatarFallback,{children:r.charAt(0).toUpperCase()})}),r]})}),(0,t.jsxs)(d.aY,{className:"flex-1 flex flex-col p-0",children:[(0,t.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[0===n.length?t.jsx("div",{className:"text-center text-muted-foreground py-8",children:t.jsx("p",{children:"No messages yet. Start the conversation!"})}):n.map(e=>{let s=e.sender_id===i?.id;return t.jsx("div",{className:`flex ${s?"justify-end":"justify-start"}`,children:(0,t.jsxs)("div",{className:`flex gap-2 max-w-[70%] ${s?"flex-row-reverse":"flex-row"}`,children:[(0,t.jsxs)(l.Avatar,{className:"h-8 w-8",children:[t.jsx(l.AvatarImage,{src:e.sender.photo_url||""}),t.jsx(l.AvatarFallback,{children:e.sender.name.charAt(0).toUpperCase()})]}),(0,t.jsxs)("div",{className:`space-y-1 ${s?"text-right":"text-left"}`,children:[t.jsx("div",{className:`inline-block p-3 rounded-lg ${s?"bg-primary text-primary-foreground":"bg-muted"}`,children:t.jsx("p",{className:"text-sm whitespace-pre-wrap",children:e.content})}),t.jsx("p",{className:"text-xs text-muted-foreground",children:(0,u.Q)(new Date(e.created_at),{addSuffix:!0})})]})]})},e.id)}),t.jsx("div",{ref:b})]}),t.jsx("div",{className:"border-t p-4",children:(0,t.jsxs)("div",{className:"flex gap-2",children:[t.jsx(h.g,{placeholder:"Type your message...",value:j,onChange:e=>v(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),y())},rows:2,className:"resize-none"}),t.jsx(x.z,{onClick:y,disabled:!j.trim()||_,size:"sm",children:_?t.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-background border-t-transparent"}):t.jsx(p.Z,{className:"h-4 w-4"})})]})})]})]})}function v(){let{user:e}=(0,f.a)();(0,i.useSearchParams)();let[s,r]=(0,a.useState)(null),{threads:l,loading:c}=(0,g.R)();return e?(0,t.jsxs)(t.Fragment,{children:[t.jsx(n.Header,{}),t.jsx("div",{className:"container mx-auto px-4 py-8",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6 h-[calc(100vh-200px)]",children:[t.jsx("div",{className:"lg:col-span-1",children:t.jsx(m,{threads:l,selectedThread:s,onSelectThread:r,loading:c})}),t.jsx("div",{className:"lg:col-span-3",children:s?t.jsx(j,{listingId:s.listingId,otherUserId:s.otherUserId,otherUserName:s.otherUserName}):t.jsx(d.Zb,{className:"h-full flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[t.jsx(o.Z,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground"}),t.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Select a conversation"}),t.jsx("p",{className:"text-muted-foreground",children:"Choose a conversation from the sidebar to start messaging."})]})})})]})})]}):(0,t.jsxs)(t.Fragment,{children:[t.jsx(n.Header,{}),t.jsx("div",{className:"container mx-auto px-4 py-8",children:(0,t.jsxs)(d.Zb,{className:"p-8 text-center",children:[t.jsx(o.Z,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground"}),t.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Messages"}),t.jsx("p",{className:"text-muted-foreground",children:"Please sign in to view your messages."})]})})]})}function _(){return t.jsx(a.Suspense,{fallback:t.jsx("div",{children:"Loading messages..."}),children:t.jsx(v,{})})}},567:(e,s,r)=>{"use strict";r.d(s,{C:()=>d});var t=r(326);r(7577);var a=r(8671),i=r(7863);let n=(0,a.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function d({className:e,variant:s,...r}){return t.jsx("div",{className:(0,i.cn)(n({variant:s}),e),...r})}},7673:(e,s,r)=>{"use strict";r.d(s,{g:()=>n});var t=r(326),a=r(7577),i=r(7863);let n=a.forwardRef(({className:e,...s},r)=>t.jsx("textarea",{className:(0,i.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:r,...s}));n.displayName="Textarea"},8386:(e,s,r)=>{"use strict";r.d(s,{R:()=>n});var t=r(7577),a=r(5442),i=r(9932);function n(e){let{user:s}=(0,i.a)(),[r,n]=(0,t.useState)([]),[d,l]=(0,t.useState)([]),[c,o]=(0,t.useState)(!0),[u,m]=(0,t.useState)(null),x=(0,t.useCallback)(async e=>{if(s)try{o(!0);let{data:r,error:t}=await a.OQ.from("messages").select(`
          *,
          sender:sender_id (
            name,
            photo_url
          )
        `).eq("listing_id",e).or(`sender_id.eq.${s.id},receiver_id.eq.${s.id}`).order("created_at",{ascending:!0});if(t)throw t;n(r)}catch(e){m(e instanceof Error?e.message:"An error occurred")}finally{o(!1)}},[s]),h=(0,t.useCallback)(async()=>{if(s)try{o(!0);let{data:e,error:r}=await a.OQ.from("messages").select(`
          *,
          listings:listing_id (
            title,
            host_id
          ),
          sender:sender_id (
            id,
            name,
            photo_url
          ),
          receiver:receiver_id (
            id,
            name,
            photo_url
          )
        `).or(`sender_id.eq.${s.id},receiver_id.eq.${s.id}`).order("created_at",{ascending:!1});if(r)throw r;let t=new Map;e?.forEach(e=>{let r=e.sender_id===s.id?e.receiver:e.sender,a=`${e.listing_id}-${r.id}`;if(t.has(a)){let r=t.get(a);e.sender_id!==s.id&&!e.read_at&&r.unread_count++}else t.set(a,{listing_id:e.listing_id,other_user:r,last_message:{content:e.content,created_at:e.created_at,sender_id:e.sender_id},unread_count:e.sender_id===s.id||e.read_at?0:1})}),l(Array.from(t.values()))}catch(e){m(e instanceof Error?e.message:"An error occurred")}finally{o(!1)}},[s]);return{messages:r,threads:d,loading:c,error:u,sendMessage:async(e,r,t)=>{if(!s)return{error:"Not authenticated"};try{let{data:i,error:d}=await a.OQ.from("messages").insert({listing_id:e,sender_id:s.id,receiver_id:r,content:t}).select(`
          *,
          sender:sender_id (
            name,
            photo_url
          )
        `).single();if(d)throw d;return e==e&&n(e=>[...e,i]),h(),{data:i,error:null}}catch(e){return{data:null,error:e instanceof Error?e.message:"An error occurred"}}},markAsRead:async(e,r)=>{if(s)try{await a.OQ.from("messages").update({read_at:new Date().toISOString()}).eq("listing_id",e).eq("sender_id",r).eq("receiver_id",s.id).is("read_at",null),n(t=>t.map(t=>t.listing_id===e&&t.sender_id===r&&t.receiver_id===s.id?{...t,read_at:new Date().toISOString()}:t)),h()}catch(e){console.error("Error marking messages as read:",e)}},refetchMessages:()=>e&&x(e),refetchThreads:h}}},9436:(e,s,r)=>{"use strict";r.d(s,{Z:()=>t});let t=(0,r(2881).Z)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]])},8244:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>t});let t=(0,r(8570).createProxy)(String.raw`/Users/sharathchandra/Documents/Make it_2025/sample/UniNest/UniNest/app/messages/page.tsx#default`)}};var s=require("../../webpack-runtime.js");s.C(e);var r=e=>s(s.s=e),t=s.X(0,[276,152,997,301,434,869,297,421,313],()=>r(5074));module.exports=t})();