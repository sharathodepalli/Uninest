(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{5161:function(e,s,t){Promise.resolve().then(t.bind(t,1045))},1045:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return Y}});var a=t(7437),r=t(2265),n=t(8808),i=t(6070),l=t(4938),c=t(2208),d=t(2718),o=t(5252),u=t(2141),m=t(9033);function h(){let{user:e}=(0,m.a)(),[s,t]=(0,r.useState)({totalListings:0,activeListings:0,totalViews:0,unreadMessages:0,monthlyRevenue:0}),[n,h]=(0,r.useState)(!0),x=(0,r.useCallback)(async()=>{if(e)try{let{data:s}=await u.OQ.from("listings").select("id, status, view_count, rent").eq("host_id",e.id),{data:a}=await u.OQ.from("messages").select("id").eq("receiver_id",e.id).is("read_at",null),r=(null==s?void 0:s.length)||0,n=(null==s?void 0:s.filter(e=>"active"===e.status).length)||0,i=(null==s?void 0:s.reduce((e,s)=>e+s.view_count,0))||0,l=(null==a?void 0:a.length)||0,c=(null==s?void 0:s.filter(e=>"active"===e.status).reduce((e,s)=>e+s.rent,0))||0;t({totalListings:r,activeListings:n,totalViews:i,unreadMessages:l,monthlyRevenue:c})}catch(e){console.error("Error fetching stats:",e)}finally{h(!1)}},[e]);(0,r.useEffect)(()=>{e&&x()},[e,x]);let f=[{title:"Total Listings",value:s.totalListings,icon:l.Z,description:"".concat(s.activeListings," active")},{title:"Total Views",value:s.totalViews,icon:c.Z,description:"All time views"},{title:"Unread Messages",value:s.unreadMessages,icon:d.Z,description:"Pending responses"},{title:"Potential Revenue",value:"$".concat(s.monthlyRevenue.toLocaleString()),icon:o.Z,description:"Monthly potential"}];return n?(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsx)(i.Zb,{className:"animate-pulse",children:(0,a.jsx)(i.aY,{className:"p-6",children:(0,a.jsx)("div",{className:"h-16 bg-muted rounded"})})},s))}):(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:f.map((e,s)=>(0,a.jsxs)(i.Zb,{children:[(0,a.jsxs)(i.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(i.ll,{className:"text-sm font-medium",children:e.title}),(0,a.jsx)(e.icon,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(i.aY,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold",children:e.value}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:e.description})]})]},s))})}var x=t(2869),f=t(5974),g=t(4508);let v=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{className:"relative w-full overflow-auto",children:(0,a.jsx)("table",{ref:s,className:(0,g.cn)("w-full caption-bottom text-sm",t),...r})})});v.displayName="Table";let j=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("thead",{ref:s,className:(0,g.cn)("[&_tr]:border-b",t),...r})});j.displayName="TableHeader";let p=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("tbody",{ref:s,className:(0,g.cn)("[&_tr:last-child]:border-0",t),...r})});p.displayName="TableBody",r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("tfoot",{ref:s,className:(0,g.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",t),...r})}).displayName="TableFooter";let y=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("tr",{ref:s,className:(0,g.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",t),...r})});y.displayName="TableRow";let b=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("th",{ref:s,className:(0,g.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",t),...r})});b.displayName="TableHead";let N=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("td",{ref:s,className:(0,g.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",t),...r})});N.displayName="TableCell",r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("caption",{ref:s,className:(0,g.cn)("mt-4 text-sm text-muted-foreground",t),...r})}).displayName="TableCaption";var w=t(4190),_=t(3774),k=t(9205);let C=(0,k.Z)("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]),Z=(0,k.Z)("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),M=(0,k.Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);var R=t(4438),S=t(7648);function A(){let{user:e}=(0,m.a)(),[s,t]=(0,r.useState)([]),[n,l]=(0,r.useState)(!0),d=(0,r.useCallback)(async()=>{if(e)try{let{data:s,error:a}=await u.OQ.from("listings").select("*").eq("host_id",e.id).order("created_at",{ascending:!1});if(a)throw a;t(s||[])}catch(e){console.error("Error fetching listings:",e),R.Am.error("Failed to load listings")}finally{l(!1)}},[e]);(0,r.useEffect)(()=>{e&&d()},[e,d]);let o=async(e,s)=>{try{let{error:a}=await u.OQ.from("listings").update({status:s}).eq("id",e);if(a)throw a;t(t=>t.map(t=>t.id===e?{...t,status:s}:t)),R.Am.success("Listing ".concat("active"===s?"activated":"deactivated"))}catch(e){R.Am.error("Failed to update listing status")}},h=async e=>{if(confirm("Are you sure you want to delete this listing?"))try{let{error:s}=await u.OQ.from("listings").delete().eq("id",e);if(s)throw s;t(s=>s.filter(s=>s.id!==e)),R.Am.success("Listing deleted")}catch(e){R.Am.error("Failed to delete listing")}},g=e=>{switch(e){case"active":return(0,a.jsx)(f.C,{className:"bg-green-500",children:"Active"});case"inactive":return(0,a.jsx)(f.C,{variant:"secondary",children:"Inactive"});case"pending":return(0,a.jsx)(f.C,{variant:"outline",children:"Pending"});case"rented":return(0,a.jsx)(f.C,{className:"bg-blue-500",children:"Rented"});default:return(0,a.jsx)(f.C,{variant:"secondary",children:e})}};return n?(0,a.jsxs)(i.Zb,{children:[(0,a.jsx)(i.Ol,{children:(0,a.jsx)(i.ll,{children:"Your Listings"})}),(0,a.jsx)(i.aY,{children:(0,a.jsx)("div",{className:"animate-pulse space-y-4",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsx)("div",{className:"h-16 bg-muted rounded"},s))})})]}):(0,a.jsxs)(i.Zb,{children:[(0,a.jsx)(i.Ol,{children:(0,a.jsx)(i.ll,{children:"Your Listings"})}),(0,a.jsx)(i.aY,{children:0===s.length?(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("p",{className:"text-muted-foreground mb-4",children:"You haven't created any listings yet"}),(0,a.jsx)(x.z,{asChild:!0,children:(0,a.jsx)(S.default,{href:"/listings/new",children:"Create Your First Listing"})})]}):(0,a.jsxs)(v,{children:[(0,a.jsx)(j,{children:(0,a.jsxs)(y,{children:[(0,a.jsx)(b,{children:"Property"}),(0,a.jsx)(b,{children:"Location"}),(0,a.jsx)(b,{children:"Rent"}),(0,a.jsx)(b,{children:"Status"}),(0,a.jsx)(b,{children:"Views"}),(0,a.jsx)(b,{children:"Created"}),(0,a.jsx)(b,{className:"w-[50px]"})]})}),(0,a.jsx)(p,{children:s.map(e=>(0,a.jsxs)(y,{children:[(0,a.jsx)(N,{children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("img",{src:e.photos_urls[0]||"https://images.pexels.com/photos/106399/pexels-photo-106399.jpeg?auto=compress&cs=tinysrgb&w=100",alt:e.title,className:"w-12 h-12 rounded object-cover"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:e.title}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:[e.bedrooms,"bd â€¢ ",e.bathrooms,"ba"]})]})]})}),(0,a.jsx)(N,{children:(0,a.jsxs)("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[(0,a.jsx)(_.Z,{className:"h-3 w-3"}),e.address.split(",")[0]]})}),(0,a.jsxs)(N,{className:"font-medium",children:["$",e.rent]}),(0,a.jsx)(N,{children:g(e.status)}),(0,a.jsx)(N,{children:(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(c.Z,{className:"h-3 w-3"}),e.view_count]})}),(0,a.jsx)(N,{className:"text-sm text-muted-foreground",children:new Date(e.created_at).toLocaleDateString()}),(0,a.jsx)(N,{children:(0,a.jsxs)(w.h_,{children:[(0,a.jsx)(w.$F,{asChild:!0,children:(0,a.jsx)(x.z,{variant:"ghost",size:"sm",children:(0,a.jsx)(C,{className:"h-4 w-4"})})}),(0,a.jsxs)(w.AW,{align:"end",children:[(0,a.jsx)(w.Xi,{asChild:!0,children:(0,a.jsxs)(S.default,{href:"/listings/".concat(e.id),children:[(0,a.jsx)(c.Z,{className:"mr-2 h-4 w-4"}),"View"]})}),(0,a.jsx)(w.Xi,{asChild:!0,children:(0,a.jsxs)(S.default,{href:"/listings/".concat(e.id,"/edit"),children:[(0,a.jsx)(Z,{className:"mr-2 h-4 w-4"}),"Edit"]})}),"active"===e.status?(0,a.jsx)(w.Xi,{onClick:()=>o(e.id,"inactive"),children:"Deactivate"}):(0,a.jsx)(w.Xi,{onClick:()=>o(e.id,"active"),children:"Activate"}),(0,a.jsxs)(w.Xi,{onClick:()=>h(e.id),className:"text-destructive",children:[(0,a.jsx)(M,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})})]},e.id))})]})})]})}var O=t(6831);let V=(0,k.Z)("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);var q=t(4098),E=t(456);function T(){let{threads:e,loading:s}=(0,q.R)();if(s)return(0,a.jsxs)(i.Zb,{children:[(0,a.jsx)(i.Ol,{children:(0,a.jsx)(i.ll,{children:"Recent Messages"})}),(0,a.jsx)(i.aY,{children:(0,a.jsx)("div",{className:"animate-pulse space-y-4",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-muted rounded-full"}),(0,a.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,a.jsx)("div",{className:"h-4 bg-muted rounded w-3/4"}),(0,a.jsx)("div",{className:"h-3 bg-muted rounded w-1/2"})]})]},s))})})]});let t=e.slice(0,5);return(0,a.jsxs)(i.Zb,{children:[(0,a.jsxs)(i.Ol,{className:"flex flex-row items-center justify-between",children:[(0,a.jsx)(i.ll,{children:"Recent Messages"}),(0,a.jsx)(x.z,{variant:"outline",size:"sm",asChild:!0,children:(0,a.jsxs)(S.default,{href:"/messages",children:["View All",(0,a.jsx)(V,{className:"ml-2 h-4 w-4"})]})})]}),(0,a.jsx)(i.aY,{children:0===t.length?(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)(d.Z,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"No messages yet"})]}):(0,a.jsx)("div",{className:"space-y-4",children:t.map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-4 p-3 border rounded-lg hover:bg-muted/50 transition-colors",children:[(0,a.jsxs)(O.Avatar,{className:"h-10 w-10",children:[(0,a.jsx)(O.AvatarImage,{src:e.other_user.photo_url||""}),(0,a.jsx)(O.AvatarFallback,{children:e.other_user.name.charAt(0).toUpperCase()})]}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,a.jsx)("h4",{className:"font-medium truncate",children:e.other_user.name}),e.unread_count>0&&(0,a.jsx)(f.C,{variant:"destructive",className:"text-xs",children:e.unread_count})]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground truncate",children:e.last_message.content}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:(0,E.Q)(new Date(e.last_message.created_at),{addSuffix:!0})})]}),(0,a.jsx)(x.z,{variant:"ghost",size:"sm",asChild:!0,children:(0,a.jsx)(S.default,{href:"/messages?listing=".concat(e.listing_id,"&host=").concat(e.other_user.id),children:"Reply"})})]},"".concat(e.listing_id,"-").concat(e.other_user.id)))})})]})}var z=t(8356),L=t(9397);let D=(0,k.Z)("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);var P=t(8728),Q=t(9376);function Y(){let{user:e,profile:s,loading:t}=(0,m.a)(),c=(0,Q.useRouter)();return((0,r.useEffect)(()=>{t||e&&(null==s?void 0:s.role)==="host"||c.push("/")},[e,s,t,c]),t)?(0,a.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,a.jsx)(n.Header,{}),(0,a.jsx)("div",{className:"container py-6",children:(0,a.jsxs)("div",{className:"animate-pulse space-y-6",children:[(0,a.jsx)("div",{className:"h-8 bg-muted rounded w-1/4"}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsx)("div",{className:"h-32 bg-muted rounded"},s))}),(0,a.jsx)("div",{className:"h-96 bg-muted rounded"})]})})]}):e&&(null==s?void 0:s.role)==="host"?(0,a.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,a.jsx)(n.Header,{}),(0,a.jsxs)("div",{className:"container py-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"Host Dashboard"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Manage your listings and connect with potential tenants"})]}),(0,a.jsx)(x.z,{asChild:!0,children:(0,a.jsxs)(S.default,{href:"/listings/new",children:[(0,a.jsx)(L.Z,{className:"mr-2 h-4 w-4"}),"Add New Listing"]})})]}),(0,a.jsx)(h,{}),(0,a.jsxs)(z.mQ,{defaultValue:"listings",className:"mt-8",children:[(0,a.jsxs)(z.dr,{className:"grid w-full grid-cols-4",children:[(0,a.jsxs)(z.SP,{value:"listings",className:"flex items-center gap-2",children:[(0,a.jsx)(l.Z,{className:"h-4 w-4"}),"Listings"]}),(0,a.jsxs)(z.SP,{value:"messages",className:"flex items-center gap-2",children:[(0,a.jsx)(d.Z,{className:"h-4 w-4"}),"Messages"]}),(0,a.jsxs)(z.SP,{value:"analytics",className:"flex items-center gap-2",children:[(0,a.jsx)(D,{className:"h-4 w-4"}),"Analytics"]}),(0,a.jsxs)(z.SP,{value:"settings",className:"flex items-center gap-2",children:[(0,a.jsx)(P.Z,{className:"h-4 w-4"}),"Settings"]})]}),(0,a.jsx)(z.nU,{value:"listings",className:"mt-6",children:(0,a.jsx)(A,{})}),(0,a.jsx)(z.nU,{value:"messages",className:"mt-6",children:(0,a.jsx)(T,{})}),(0,a.jsx)(z.nU,{value:"analytics",className:"mt-6",children:(0,a.jsxs)(i.Zb,{children:[(0,a.jsxs)(i.Ol,{children:[(0,a.jsx)(i.ll,{children:"Analytics"}),(0,a.jsx)(i.SZ,{children:"View detailed analytics about your listings performance"})]}),(0,a.jsx)(i.aY,{children:(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)(D,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Analytics dashboard coming soon"})]})})]})}),(0,a.jsx)(z.nU,{value:"settings",className:"mt-6",children:(0,a.jsxs)(i.Zb,{children:[(0,a.jsxs)(i.Ol,{children:[(0,a.jsx)(i.ll,{children:"Account Settings"}),(0,a.jsx)(i.SZ,{children:"Manage your host account preferences"})]}),(0,a.jsx)(i.aY,{children:(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)(P.Z,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Settings panel coming soon"})]})})]})})]})]})]}):null}},5974:function(e,s,t){"use strict";t.d(s,{C:function(){return l}});var a=t(7437);t(2265);var r=t(7712),n=t(4508);let i=(0,r.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function l(e){let{className:s,variant:t,...r}=e;return(0,a.jsx)("div",{className:(0,n.cn)(i({variant:t}),s),...r})}},8356:function(e,s,t){"use strict";t.d(s,{mQ:function(){return R},nU:function(){return O},dr:function(){return S},SP:function(){return A}});var a=t(7437),r=t(2265),n=t(6741),i=t(3966),l=t(4545),c=t(1599),d=t(6840),o=t(9114),u=t(886),m=t(9255),h="Tabs",[x,f]=(0,i.b)(h,[l.Pc]),g=(0,l.Pc)(),[v,j]=x(h),p=r.forwardRef((e,s)=>{let{__scopeTabs:t,value:r,onValueChange:n,defaultValue:i,orientation:l="horizontal",dir:c,activationMode:h="automatic",...x}=e,f=(0,o.gm)(c),[g,j]=(0,u.T)({prop:r,onChange:n,defaultProp:i});return(0,a.jsx)(v,{scope:t,baseId:(0,m.M)(),value:g,onValueChange:j,orientation:l,dir:f,activationMode:h,children:(0,a.jsx)(d.WV.div,{dir:f,"data-orientation":l,...x,ref:s})})});p.displayName=h;var y="TabsList",b=r.forwardRef((e,s)=>{let{__scopeTabs:t,loop:r=!0,...n}=e,i=j(y,t),c=g(t);return(0,a.jsx)(l.fC,{asChild:!0,...c,orientation:i.orientation,dir:i.dir,loop:r,children:(0,a.jsx)(d.WV.div,{role:"tablist","aria-orientation":i.orientation,...n,ref:s})})});b.displayName=y;var N="TabsTrigger",w=r.forwardRef((e,s)=>{let{__scopeTabs:t,value:r,disabled:i=!1,...c}=e,o=j(N,t),u=g(t),m=C(o.baseId,r),h=Z(o.baseId,r),x=r===o.value;return(0,a.jsx)(l.ck,{asChild:!0,...u,focusable:!i,active:x,children:(0,a.jsx)(d.WV.button,{type:"button",role:"tab","aria-selected":x,"aria-controls":h,"data-state":x?"active":"inactive","data-disabled":i?"":void 0,disabled:i,id:m,...c,ref:s,onMouseDown:(0,n.M)(e.onMouseDown,e=>{i||0!==e.button||!1!==e.ctrlKey?e.preventDefault():o.onValueChange(r)}),onKeyDown:(0,n.M)(e.onKeyDown,e=>{[" ","Enter"].includes(e.key)&&o.onValueChange(r)}),onFocus:(0,n.M)(e.onFocus,()=>{let e="manual"!==o.activationMode;x||i||!e||o.onValueChange(r)})})})});w.displayName=N;var _="TabsContent",k=r.forwardRef((e,s)=>{let{__scopeTabs:t,value:n,forceMount:i,children:l,...o}=e,u=j(_,t),m=C(u.baseId,n),h=Z(u.baseId,n),x=n===u.value,f=r.useRef(x);return r.useEffect(()=>{let e=requestAnimationFrame(()=>f.current=!1);return()=>cancelAnimationFrame(e)},[]),(0,a.jsx)(c.z,{present:i||x,children:t=>{let{present:r}=t;return(0,a.jsx)(d.WV.div,{"data-state":x?"active":"inactive","data-orientation":u.orientation,role:"tabpanel","aria-labelledby":m,hidden:!r,id:h,tabIndex:0,...o,ref:s,style:{...e.style,animationDuration:f.current?"0s":void 0},children:r&&l})}})});function C(e,s){return"".concat(e,"-trigger-").concat(s)}function Z(e,s){return"".concat(e,"-content-").concat(s)}k.displayName=_;var M=t(4508);let R=p,S=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(b,{ref:s,className:(0,M.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",t),...r})});S.displayName=b.displayName;let A=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(w,{ref:s,className:(0,M.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",t),...r})});A.displayName=w.displayName;let O=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(k,{ref:s,className:(0,M.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...r})});O.displayName=k.displayName},4098:function(e,s,t){"use strict";t.d(s,{R:function(){return i}});var a=t(2265),r=t(2141),n=t(9033);function i(e){let{user:s}=(0,n.a)(),[t,i]=(0,a.useState)([]),[l,c]=(0,a.useState)([]),[d,o]=(0,a.useState)(!0),[u,m]=(0,a.useState)(null),h=(0,a.useCallback)(async e=>{if(s)try{o(!0);let{data:t,error:a}=await r.OQ.from("messages").select("\n          *,\n          sender:sender_id (\n            name,\n            photo_url\n          )\n        ").eq("listing_id",e).or("sender_id.eq.".concat(s.id,",receiver_id.eq.").concat(s.id)).order("created_at",{ascending:!0});if(a)throw a;i(t)}catch(e){m(e instanceof Error?e.message:"An error occurred")}finally{o(!1)}},[s]),x=(0,a.useCallback)(async()=>{if(s)try{o(!0);let{data:e,error:t}=await r.OQ.from("messages").select("\n          *,\n          listings:listing_id (\n            title,\n            host_id\n          ),\n          sender:sender_id (\n            id,\n            name,\n            photo_url\n          ),\n          receiver:receiver_id (\n            id,\n            name,\n            photo_url\n          )\n        ").or("sender_id.eq.".concat(s.id,",receiver_id.eq.").concat(s.id)).order("created_at",{ascending:!1});if(t)throw t;let a=new Map;null==e||e.forEach(e=>{let t=e.sender_id===s.id?e.receiver:e.sender,r="".concat(e.listing_id,"-").concat(t.id);if(a.has(r)){let t=a.get(r);e.sender_id!==s.id&&!e.read_at&&t.unread_count++}else a.set(r,{listing_id:e.listing_id,other_user:t,last_message:{content:e.content,created_at:e.created_at,sender_id:e.sender_id},unread_count:e.sender_id===s.id||e.read_at?0:1})}),c(Array.from(a.values()))}catch(e){m(e instanceof Error?e.message:"An error occurred")}finally{o(!1)}},[s]),f=async(e,t,a)=>{if(!s)return{error:"Not authenticated"};try{let{data:n,error:l}=await r.OQ.from("messages").insert({listing_id:e,sender_id:s.id,receiver_id:t,content:a}).select("\n          *,\n          sender:sender_id (\n            name,\n            photo_url\n          )\n        ").single();if(l)throw l;return e==e&&i(e=>[...e,n]),x(),{data:n,error:null}}catch(e){return{data:null,error:e instanceof Error?e.message:"An error occurred"}}},g=async(e,t)=>{if(s)try{await r.OQ.from("messages").update({read_at:new Date().toISOString()}).eq("listing_id",e).eq("sender_id",t).eq("receiver_id",s.id).is("read_at",null),i(a=>a.map(a=>a.listing_id===e&&a.sender_id===t&&a.receiver_id===s.id?{...a,read_at:new Date().toISOString()}:a)),x()}catch(e){console.error("Error marking messages as read:",e)}};return(0,a.useEffect)(()=>{if(!s||!e)return;let t=r.OQ.channel("messages:".concat(e)).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:"listing_id=eq.".concat(e)},async e=>{let{data:s}=await r.OQ.from("messages").select("\n              *,\n              sender:sender_id (\n                name,\n                photo_url\n              )\n            ").eq("id",e.new.id).single();s&&i(e=>[...e,s])}).subscribe();return()=>{r.OQ.removeChannel(t)}},[s,e]),(0,a.useEffect)(()=>{e?h(e):x()},[e,h,x]),{messages:t,threads:l,loading:d,error:u,sendMessage:f,markAsRead:g,refetchMessages:()=>e&&h(e),refetchThreads:x}}},5252:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(9205).Z)("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]])},2208:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(9205).Z)("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},3774:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(9205).Z)("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])},8728:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(9205).Z)("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])}},function(e){e.O(0,[438,580,212,648,964,562,456,919,971,117,744],function(){return e(e.s=5161)}),_N_E=e.O()}]);